SELECT 
	HIST.CUSNO,
	HIST.CUSNM,
	HIST."Market",
	HIST.ORDNO,
	HIST.FDCM,
	HIST.TD,
	HIST.PODT,
	HIST.PODY,
	HIST.CODT,
	HIST.CODY,
	(Week(HIST.CODT) - Week(HIST.PODT)) * 5 + (DayofWeek(HIST.CODT) - DayofWeek(HIST.PODT)) "WDTS"

FROM
	
(
	SELECT 
		 MBBWCPP.BWCANB	AS	"CUSNO",
		 MBBWCPP.BWAQTX AS "CUSNM",
		 MBI9REP.I9ADR7 AS "Market",
		 MBBWCPP.BWCVNB	AS	"ORDNO",
	
	DATE(CURRENT DATE - DAY(CURRENT DATE) DAYS) +1 DAYS "FDCM", -- first day of current month
	DATE(CURRENT DATE) "TD",-- today
	
	
	DATE(concat(concat(concat(substr(char((MBBWCPP.BWDXNB-1000000)+20000000),1,4),'-'),
			concat(substr(char((MBBWCPP.BWDXNB-1000000)+20000000),5,2), '-')),
			substr(char((MBBWCPP.BWDXNB-1000000)+20000000),7,2))) "PODT",
			
	DayofWeek(DATE(concat(concat(concat(substr(char((MBBWCPP.BWDXNB-1000000)+20000000),1,4),'-'),
			concat(substr(char((MBBWCPP.BWDXNB-1000000)+20000000),5,2), '-')),
			substr(char((MBBWCPP.BWDXNB-1000000)+20000000),7,2)))) "PODY",
			
	DATE(concat(concat(concat(substr(char((MBBWCPP.BWAABS-1000000)+20000000),1,4),'-'),
			concat(substr(char((MBBWCPP.BWAABS-1000000)+20000000),5,2), '-')),
			substr(char((MBBWCPP.BWAABS-1000000)+20000000),7,2))) "CODT",
			
	DayofWeek(DATE(concat(concat(concat(substr(char((MBBWCPP.BWAABS-1000000)+20000000),1,4),'-'),
			concat(substr(char((MBBWCPP.BWAABS-1000000)+20000000),5,2), '-')),
			substr(char((MBBWCPP.BWAABS-1000000)+20000000),7,2)))) "CODY"	
	
	FROM AMFLIB.MBBWCPP MBBWCPP
	
	JOIN AMFLIB.MBDHREP MBDHREP
	ON	MBBWCPP.BWAENB = MBDHREP.DHAENB
	AND	MBBWCPP.BWDCCD = MBDHREP.DHDCCD
	AND	MBBWCPP.BWCVNB = MBDHREP.DHCVNB
	
	JOIN AMFLIB.MBI9REP MBI9REP
	ON MBDHREP.DHADR6 = MBI9REP.I9ADR6
) HIST	

WHERE DATE(HIST.CODT) 
	BETWEEN DATE(HIST.FDCM) 
	AND DATE(HIST.CODT)