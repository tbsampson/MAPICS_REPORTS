/*
	Sales by Customer for FY2018 with credit terms
	total in total invoice amt
	Tom Sampson
	20180829
*/

SELECT
	 MBF9REP.FEKNNB	"CusNo"
 	,MBBFREP.CUSNM "Bill to Customer Name"
	,MBDYREP.DYA2TX	"Terms description"

	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170401 AND 1170430
		THEN MBF9REP.FEIZVA
	 END) "Apr 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170501 AND 1170531
		THEN MBF9REP.FEIZVA
	 END) "May 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170601 AND 1170630
		THEN MBF9REP.FEIZVA
	 END) "Jun 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170701 AND 1170731
		THEN MBF9REP.FEIZVA
	 END) "Jul 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170801 AND 1170831
		THEN MBF9REP.FEIZVA
	 END) "Aug 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170901 AND 1170930
		THEN MBF9REP.FEIZVA
	 END) "Sep 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1171001 AND 1171031
		THEN MBF9REP.FEIZVA
	 END) "Oct 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1171101 AND 1171130
		THEN MBF9REP.FEIZVA
	 END) "Nov 17"
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1171201 AND 1171231
		THEN MBF9REP.FEIZVA
	 END) "Dec 17"	 
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1180101 AND 1180131
		THEN MBF9REP.FEIZVA
	 END) "Jan 18"	
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1180201 AND 1180230
		THEN MBF9REP.FEIZVA
	 END) "Feb 18"	
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1180301 AND 1180331
		THEN MBF9REP.FEIZVA
	 END) "Mar 18"		 
	,SUM(CASE WHEN MBF9REP.FEGHNB BETWEEN 1170401 AND 1180331
		THEN MBF9REP.FEIZVA
	 END) "Total FY18"
FROM AMFLIB.MBF9REP MBF9REP

LEFT JOIN AMFLIB.MBBFREP MBBFREP
	ON MBF9REP.FEABBJ = MBBFREP.CUSNO -- Customer Number on Sold to Customer


JOIN AMFLIB.MBDYREP MBDYREP
	ON 	MBDYREP.DYBLCD = MBBFREP.STERM -- "Terms Code"

WHERE MBF9REP.FEGHNB BETWEEN 1170401 AND 1180331

GROUP BY
	 MBF9REP.FEKNNB	-- "Bill to CustomerNumber"
	,MBBFREP.CUSNM -- "Bill to Customer Name"
	,MBDYREP.DYA2TX	-- "Terms description"
	
-- ORDER BY MBBFREP.CUSNM